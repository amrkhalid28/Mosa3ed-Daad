<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø£Ø¯Ø§Ø© Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø¹Ø±ÙˆØ¶ Ø§Ù„ÙÙ†ÙŠØ© | Daad</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcode-generator/1.4.4/qrcode.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700;900&display=swap" rel="stylesheet">

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'dark-primary': '#501323', 'dark-secondary': '#3E0F1C', 'accent-gold': '#D5C5A0', 
                        'text-light': '#F2E8D8', 'highlight-green': '#10B981', 'highlight-orange': '#F59E0B', 
                        'text-contrast': '#E0D6BC', 
                    },
                    fontFamily: { sans: ['Cairo', 'sans-serif'] }
                }
            }
        }
    </script>
    <style>
        :root { font-family: 'Cairo', sans-serif; }
        body { background-color: #501323; background-image: radial-gradient(circle at center, #501323 0%, #3E0F1C 100%); min-height: 100vh; background-attachment: fixed; }
        .scrollbar-thin::-webkit-scrollbar { width: 8px; height: 8px; }
        .scrollbar-thin::-webkit-scrollbar-thumb { background-color: #D5C5A0; border-radius: 10px; }
        .scrollbar-thin::-webkit-scrollbar-track { background-color: #3E0F1C; }
        input, textarea, select { background-color: #3E0F1C; color: #F2E8D8; border: 1px solid #501323; transition: border-color 0.2s; }
        input:focus, textarea:focus, select:focus { border-color: #D5C5A0; box-shadow: 0 0 0 2px rgba(213, 197, 160, 0.5); outline: none; }
        
        /* ØªØ­Ø³ÙŠÙ† Ø´ÙƒÙ„ Ø§Ù„Ù€ Checkbox */
        input[type="checkbox"] { 
            -webkit-appearance: none; appearance: none; 
            width: 1.25rem; height: 1.25rem; 
            border: 2px solid #D5C5A0; border-radius: 0.25rem; 
            background-color: #3E0F1C; cursor: pointer; position: relative; 
            display: inline-flex; align-items: center; justify-content: center;
        }
        input[type="checkbox"]:checked { background-color: #D5C5A0; border-color: #D5C5A0; }
        input[type="checkbox"]:checked::after { content: 'âœ“'; color: #501323; font-size: 0.9rem; font-weight: 900; }
        
        .logo-float { position: fixed; bottom: 20px; left: 20px; z-index: 50; cursor: pointer; border-radius: 9999px; transition: transform 0.3s, box-shadow 0.3s; box-shadow: 0 4px 15px rgba(0, 0, 0, 0.5); background-color: #3E0F1C; border: 3px solid #E0D6BC; width: 70px; height: 70px; display: flex; align-items: center; justify-content: center; overflow: hidden; }
        .logo-float:hover { transform: scale(1.05); box-shadow: 0 8px 20px rgba(0, 0, 0, 0.7); }
        .logo-float img { width: 100%; height: 100%; object-fit: contain; border-radius: 9999px; }
        
        .modal-backdrop { transition: opacity 0.3s ease; }
        .chat-log { height: 450px; }
        .chat-message { max-width: 85%; word-wrap: break-word; line-height: 1.7; font-size: 0.95rem; }
        .user-message { background-color: #D5C5A0; color: #3E0F1C; align-self: flex-start; }
        .bot-message { background-color: #3E0F1C; color: #F2E8D8; border: 1px solid #501323; align-self: flex-end; }
        .bot-message ul { list-style: disc; padding-right: 20px; margin: 8px 0; }
        .bot-message strong { color: #D5C5A0; font-weight: 700; }
        
        .loading-dots span { width: 8px; height: 8px; background-color: #D5C5A0; border-radius: 50%; display: inline-block; animation: bounce 1.4s infinite ease-in-out both; }
        .loading-dots span:nth-child(1) { animation-delay: -0.32s; }
        .loading-dots span:nth-child(2) { animation-delay: -0.16s; }
        @keyframes bounce { 0%, 80%, 100% { transform: scale(0); } 40% { transform: scale(1.0); } }
        
        /* ØªØ­Ø³ÙŠÙ†Ø§Øª Ø§Ù„Ø·Ø¨Ø§Ø¹Ø© */
        @media print { 
            .no-print { display: none !important; } 
            body { background-color: white !important; background-image: none !important; color: black !important; } 
            .print-area { width: 100%; margin: 0; padding: 0; display: block !important; } 
            .logo-float { display: none !important; }
            .bg-dark-secondary { background-color: white !important; border: 1px solid #ccc !important; box-shadow: none !important; color: black !important; }
            .text-accent-gold { color: #000 !important; text-decoration: underline; }
            .text-text-light { color: #000 !important; }
            input[type="checkbox"] { border-color: #000 !important; }
            input[type="checkbox"]:checked { background-color: #000 !important; }
            input[type="checkbox"]:checked::after { color: white !important; }
            .page-break-inside-avoid { break-inside: avoid; page-break-inside: avoid; }
        }
        
        /* Animation for details */
        .fade-in { animation: fadeIn 0.3s ease-in; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(-5px); } to { opacity: 1; transform: translateY(0); } }
    </style>
</head>
<body class="text-text-light antialiased">

    <!-- Ø§Ù„Ø´Ø§Ø´Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© -->
    <main id="home-view" class="min-h-screen w-full flex items-center justify-center p-4 transition-opacity duration-500 opacity-100">
        <div class="max-w-4xl mx-auto w-full">
            <img src="https://i.ibb.co/fz5m8DNf/imgi-102-cropped-cropped-logo-daad-2000x2000-1-1-700x700-removebg-preview.png" alt="Daad Logo" class="h-24 w-auto rounded-lg shadow-md border border-accent-gold mx-auto mb-6 object-contain bg-dark-secondary/50 p-2" onerror="this.onerror=null; this.src='https://placehold.co/100x80/501323/D5C5A0?text=DAAD';">
            <h1 class="text-4xl font-bold text-accent-gold mb-4 text-center">Ø£Ø¯Ø§Ø© Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø¹Ø±ÙˆØ¶ Ø§Ù„ÙÙ†ÙŠØ© | Daad</h1>
            <p class="text-lg text-text-light/90 mb-12 text-center">Ø§Ø¨Ø¯Ø£ Ø¨ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ù…ÙØ¶Ù„Ø© Ù„Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø®Ø·Ø©.</p>
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                <div onclick="selectAssistantMode()" class="md:col-span-2 bg-accent-gold text-dark-primary p-8 rounded-xl shadow-2xl transition-all duration-300 transform hover:scale-[1.02] cursor-pointer hover:shadow-accent-gold/20">
                    <h2 class="text-3xl font-bold mb-3">Ø§Ù„Ø§Ø³ØªØ¹Ø§Ù†Ø© Ø¨Ù…Ø³Ø§Ø¹Ø¯ Ø¶</h2>
                    <p class="text-lg text-dark-primary/80 font-semibold">Ø¯Ø¹ Ø§Ù„Ù…Ø³ØªØ´Ø§Ø± Ø§Ù„Ø°ÙƒÙŠ ÙŠØ­Ù„Ù„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø´Ø±ÙˆØ¹ ÙˆÙŠÙ‚ØªØ±Ø­ Ø®Ø·Ø© Ø§Ø³ØªØ±Ø§ØªÙŠØ¬ÙŠØ© Ø§Ø­ØªØ±Ø§ÙÙŠØ©.</p>
                </div>
                <div onclick="selectManualMode()" class="md:col-span-1 bg-dark-secondary text-text-light p-8 rounded-xl shadow-xl border-2 border-accent-gold/50 transition-all duration-300 transform hover:scale-[1.02] cursor-pointer hover:border-accent-gold">
                    <h2 class="text-3xl font-bold mb-3">Ø§Ù„Ø¨Ø¯Ø¡ ÙŠØ¯ÙˆÙŠØ§Ù‹</h2>
                    <p class="text-lg text-text-light/80">Ø§Ø®ØªØ± Ø§Ù„Ø®Ø¯Ù…Ø§Øª ÙˆØ§Ù„Ø£Ø´Ù‡Ø± Ø¨Ù†ÙØ³Ùƒ.</p>
                </div>
            </div>
        </div>
    </main>

    <!-- Ù†Ø§ÙØ°Ø© Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¹Ù…ÙŠÙ„ -->
    <div id="client-info-modal" class="modal-backdrop fixed inset-0 bg-black/80 backdrop-blur-sm flex items-center justify-center p-4 z-[100] opacity-0 pointer-events-none hidden" onclick="closeClientInfoModal()">
        <div class="bg-dark-secondary rounded-xl shadow-2xl border border-accent-gold/50 max-w-3xl w-full p-6 transform transition-all" onclick="event.stopPropagation()">
            <div class="flex justify-between items-center mb-4 border-b border-dark-primary pb-3">
                <h2 class="text-2xl font-bold text-accent-gold">Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø´Ø±ÙˆØ¹</h2>
                <button onclick="closeClientInfoModal()" class="text-text-light/70 hover:text-accent-gold transition-colors text-2xl">&times;</button>
            </div>
            <form id="client-info-form" class="space-y-4 max-h-[70vh] overflow-y-auto scrollbar-thin pr-2">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div><label class="block text-sm font-medium text-accent-gold mb-1">Ø§Ø³Ù… Ø§Ù„Ù…Ø´Ø±ÙˆØ¹ *</label><input type="text" id="client-name" class="w-full p-3 rounded-lg border border-dark-primary outline-none focus:ring-1 focus:ring-accent-gold"></div>
                    <div><label class="block text-sm font-medium text-accent-gold mb-1">Ø±Ù‚Ù… Ø§Ù„ØªÙˆØ§ØµÙ„</label><input type="text" id="client-contact-phone" class="w-full p-3 rounded-lg border border-dark-primary outline-none"></div>
                </div>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div><label class="block text-sm font-medium text-accent-gold mb-1">Ø±Ø§Ø¨Ø· Ø§Ù„Ù…ØªØ¬Ø±/Ø§Ù„Ù…ÙˆÙ‚Ø¹</label><input type="url" id="client-link" class="w-full p-3 rounded-lg border border-dark-primary outline-none"></div>
                    <div><label class="block text-sm font-medium text-accent-gold mb-1">Ø­Ø³Ø§Ø¨Ø§Øª Ø§Ù„Ø³ÙˆØ´ÙŠØ§Ù„</label><input type="text" id="client-social-links" class="w-full p-3 rounded-lg border border-dark-primary outline-none"></div>
                </div>
                <div><label class="block text-sm font-medium text-accent-gold mb-1">Ù†ÙˆØ¹ Ø§Ù„Ù†Ø´Ø§Ø·</label><input type="text" id="client-business-type" class="w-full p-3 rounded-lg border border-dark-primary outline-none" placeholder="Ù…Ø«Ø§Ù„: Ù…ØªØ¬Ø± Ø¹Ø·ÙˆØ±ØŒ Ø´Ø±ÙƒØ© Ù…Ù‚Ø§ÙˆÙ„Ø§Øª..."></div>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div><label class="block text-sm font-medium text-accent-gold mb-1">Ø§Ù„Ø¬Ù…Ù‡ÙˆØ± Ø§Ù„Ù…Ø³ØªÙ‡Ø¯Ù</label><input type="text" id="client-target-audience" class="w-full p-3 rounded-lg border border-dark-primary outline-none"></div>
                    <div><label class="block text-sm font-medium text-accent-gold mb-1">Ø£Ø¨Ø±Ø² Ø§Ù„Ù…Ù†Ø§ÙØ³ÙŠÙ†</label><input type="text" id="client-competitors" class="w-full p-3 rounded-lg border border-dark-primary outline-none"></div>
                </div>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm font-medium text-accent-gold mb-1">Ø§Ù„Ù‡Ø¯Ù Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ</label>
                        <select id="client-strategy-goal" class="w-full p-3 rounded-lg border border-dark-primary outline-none">
                            <option value="Ø²ÙŠØ§Ø¯Ø© Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª">Ø²ÙŠØ§Ø¯Ø© Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª</option>
                            <option value="Ø§Ù„ÙˆØ¹ÙŠ Ø¨Ø§Ù„Ø¹Ù„Ø§Ù…Ø©">Ø§Ù„ÙˆØ¹ÙŠ Ø¨Ø§Ù„Ø¹Ù„Ø§Ù…Ø© Ø§Ù„ØªØ¬Ø§Ø±ÙŠØ©</option>
                            <option value="Ø¥Ø·Ù„Ø§Ù‚ Ù…Ù†ØªØ¬ Ø¬Ø¯ÙŠØ¯">Ø¥Ø·Ù„Ø§Ù‚ Ù…Ù†ØªØ¬ Ø¬Ø¯ÙŠØ¯</option>
                            <option value="ØªØ­Ø³ÙŠÙ† Ø§Ù„Ø¸Ù‡ÙˆØ± Ø§Ù„Ø±Ù‚Ù…ÙŠ">ØªØ­Ø³ÙŠÙ† Ø§Ù„Ø¸Ù‡ÙˆØ± Ø§Ù„Ø±Ù‚Ù…ÙŠ</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-accent-gold mb-1">Ø§Ù„Ù…ÙŠØ²Ø§Ù†ÙŠØ© Ø§Ù„Ù…ØªÙˆÙ‚Ø¹Ø©</label>
                        <select id="client-budget-range" class="w-full p-3 rounded-lg border border-dark-primary outline-none">
                            <option value="Ù…ØªÙˆØ³Ø·Ø©">Ù…ØªÙˆØ³Ø·Ø©</option>
                            <option value="ÙƒØ¨ÙŠØ±Ø©">ÙƒØ¨ÙŠØ±Ø© (VIP)</option>
                            <option value="Ù…Ø­Ø¯ÙˆØ¯Ø©">Ù…Ø­Ø¯ÙˆØ¯Ø© (Startup)</option>
                        </select>
                    </div>
                </div>
                <div><label class="block text-sm font-medium text-accent-gold mb-1">Ø§Ù„ØªØ­Ø¯ÙŠØ§Øª Ø§Ù„Ø­Ø§Ù„ÙŠØ©</label><textarea id="client-challenges" rows="2" class="w-full p-3 rounded-lg border border-dark-primary outline-none"></textarea></div>
                <div><label class="block text-sm font-medium text-accent-gold mb-1">Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø¥Ø¶Ø§ÙÙŠØ©</label><textarea id="client-additional-info" rows="2" class="w-full p-3 rounded-lg border border-dark-primary outline-none"></textarea></div>
                
                <button type="button" id="save-client-info-btn" onclick="handleClientInfoSubmit()" class="bg-accent-gold hover:bg-opacity-90 text-dark-primary font-bold py-3 px-6 rounded-xl shadow-lg w-full transition duration-300 mt-4">Ø­ÙØ¸ ÙˆØ¨Ø¯Ø¡ Ø§Ù„ØªØ­Ù„ÙŠÙ„</button>
            </form>
        </div>
    </div>

    <!-- Ù†Ø§ÙØ°Ø© Ø§Ù„Ø´Ø§Øª (AI) -->
    <div id="ai-modal" class="modal-backdrop fixed inset-0 bg-black/80 backdrop-blur-sm flex items-center justify-center p-4 z-[100] opacity-0 pointer-events-none hidden" onclick="closeAiModal()">
        <div class="bg-dark-secondary rounded-xl shadow-2xl border border-accent-gold/50 max-w-3xl w-full p-6 flex flex-col h-[85vh]" onclick="event.stopPropagation()">
            <div class="flex justify-between items-center mb-4 border-b border-dark-primary pb-3">
                <div class="flex items-center">
                    <div class="w-10 h-10 rounded-full bg-accent-gold flex items-center justify-center ml-3 text-dark-primary text-2xl border border-dark-primary shadow-inner">ğŸ¤–</div>
                    <div><h2 class="text-xl font-bold text-accent-gold">Ù…Ø³Ø§Ø¹Ø¯ Ø¶</h2><p class="text-xs text-text-light/60">Ù…Ø³ØªØ´Ø§Ø±Ùƒ Ø§Ù„Ø§Ø³ØªØ±Ø§ØªÙŠØ¬ÙŠ Ø§Ù„Ø°ÙƒÙŠ</p></div>
                </div>
                <button onclick="closeAiModal()" class="text-text-light/70 hover:text-accent-gold text-2xl">&times;</button>
            </div>
            <div id="chat-log" class="chat-log w-full flex-grow bg-dark-primary/30 rounded-lg p-4 overflow-y-auto scrollbar-thin flex flex-col space-y-4 mb-4 border border-dark-primary/50"></div>
            <div class="relative pt-2 border-t border-dark-primary">
                <textarea id="chat-input" rows="2" class="w-full p-4 pl-14 rounded-xl border border-dark-primary bg-dark-primary/50 focus:border-accent-gold outline-none resize-none text-text-light placeholder-text-light/30" placeholder="Ø§ÙƒØªØ¨ Ø±Ø¯Ùƒ Ù‡Ù†Ø§..."></textarea>
                <button id="chat-send-btn" onclick="sendChatMessage()" class="absolute left-2 bottom-3 bg-accent-gold text-dark-primary w-10 h-10 flex items-center justify-center rounded-lg hover:bg-opacity-90 transition-colors shadow-lg">
                    <svg class="w-5 h-5 transform rotate-90" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 19l9 2-9-18-9 18 9-2zm0 0v-8"></path></svg>
                </button>
            </div>
        </div>
    </div>

    <!-- ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ (Ø§Ù„Ø¬Ø¯ÙˆÙ„) -->
    <div id="app-view" class="min-h-screen flex flex-col print-area hidden">
        <header class="sticky top-0 bg-dark-primary shadow-2xl p-4 z-20 no-print border-b border-dark-secondary">
            <div class="max-w-7xl mx-auto flex justify-between items-center">
                <div class="flex items-center space-x-4 space-x-reverse">
                    <img src="https://i.ibb.co/fz5m8DNf/imgi-102-cropped-cropped-logo-daad-2000x2000-1-1-700x700-removebg-preview.png" alt="Daad Logo" class="h-12 w-auto rounded-lg border border-accent-gold bg-dark-secondary p-1">
                    <button onclick="openClientInfoModal()" class="bg-dark-secondary text-accent-gold hover:text-white hover:bg-dark-secondary/80 border border-accent-gold/30 font-bold py-2 px-4 rounded-xl shadow-lg text-sm transition-all">Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø´Ø±ÙˆØ¹</button>
                </div>
                <div class="flex space-x-3 space-x-reverse">
                    <button onclick="openAiModal()" class="bg-dark-secondary text-accent-gold hover:text-white border border-accent-gold/30 font-bold py-2 px-4 rounded-xl shadow-lg text-sm flex items-center gap-2 transition-all">
                        <span>Ù…Ø³Ø§Ø¹Ø¯ Ø¶</span>
                        <span class="text-lg">ğŸ¤–</span>
                    </button>
                    <button onclick="generateTechnicalProposal()" class="bg-accent-gold text-dark-primary hover:bg-white font-bold py-2 px-6 rounded-xl shadow-lg text-sm transition-colors">Ø·Ø¨Ø§Ø¹Ø© / PDF</button>
                </div>
            </div>
        </header>
        
        <main class="flex-grow max-w-7xl mx-auto w-full p-4 print:p-0">
            <!-- Ø±Ø³Ø§Ø¦Ù„ Ø§Ù„Ù†Ø¸Ø§Ù… -->
            <div id="system-message" class="fixed top-24 right-4 bg-accent-gold text-dark-primary p-4 rounded-xl shadow-2xl transition-all duration-500 opacity-0 transform translate-y-10 no-print z-50 font-bold border border-white/20"></div>
            
            <!-- Ø´Ø¨ÙƒØ© Ø§Ù„Ø£Ø´Ù‡Ø± -->
            <div id="months-grid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6 mt-8 print:grid-cols-2 print:gap-4"></div>
            
            <div class="flex justify-center mt-10 mb-10 no-print">
                <button onclick="addNextMonth()" id="add-month-button" class="bg-highlight-green hover:bg-green-600 text-white font-bold py-3 px-8 rounded-xl shadow-lg transition-transform hover:scale-105 flex items-center gap-2">
                    <span class="text-2xl">+</span> Ø´Ù‡Ø± Ø¬Ø¯ÙŠØ¯
                </button>
            </div>
        </main>
    </div>

    <a href="https://wa.me/+966592136734" target="_blank" class="logo-float no-print" title="ØªÙˆØ§ØµÙ„ Ù…Ø¹Ù†Ø§">
        <img src="https://i.ibb.co/fz5m8DNf/imgi-102-cropped-cropped-logo-daad-2000x2000-1-1-700x700-removebg-preview.png" onerror="this.onerror=null; this.src='https://placehold.co/70x70/501323/D5C5A0?text=DAAD';">
    </a>

    <script>
        // =================================================================
        // Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù†Ø¸Ø§Ù…
        // =================================================================
        
        // Ø§Ù„Ø±Ø§Ø¨Ø· Ø§Ù„Ù…Ø­Ø¯Ø¯ Ù„Ù„Ø³ÙƒØ±Ø¨Øª
        const GOOGLE_SCRIPT_URL = "https://script.google.com/macros/s/AKfycbyrj9Umd1XWXG-BYVU6KVgYeVVB99w94Fn_Rw2g4HZSwr1YWjD9o0U7Sc8_9KAbhd2A/exec"; 
        const PROPOSAL_STORAGE_KEY = 'daad_proposal';
        const CLIENT_INFO_KEY = 'daad_client';
        const MAX_MONTHS = 12;
        
        let monthlySelections = [{}];
        let visibleMonths = 1;
        let chatHistory = [];
        let isAssistantMode = false;

        const services = [
            {id:'branding', name:'Ù‡ÙˆÙŠØ© Ø¨ØµØ±ÙŠØ©'}, 
            {id:'ui_ux', name:'UI/UX ØªØµÙ…ÙŠÙ…'}, 
            {id:'salla_zid', name:'ØªØ£Ø³ÙŠØ³ Ù…ØªØ¬Ø± (Ø³Ù„Ø©/Ø²Ø¯)'}, 
            {id:'wordpress', name:'Ù…ÙˆÙ‚Ø¹ ÙˆÙˆØ±Ø¯Ø¨Ø±Ø³'},
            {id:'social', name:'Ø¥Ø¯Ø§Ø±Ø© Ø³ÙˆØ´ÙŠØ§Ù„ Ù…ÙŠØ¯ÙŠØ§'}, 
            {id:'mb', name:'Media Buying (Ø¥Ø¹Ù„Ø§Ù†Ø§Øª)'}, 
            {id:'seo', name:'SEO (Ù…Ø­Ø±ÙƒØ§Øª Ø¨Ø­Ø«)'},
            {id:'cro', name:'CRO (ØªØ­Ø³ÙŠÙ† Ø§Ù„ØªØ­ÙˆÙŠÙ„)'}
        ];
        
        // Ø§Ù„ØªÙØ§ØµÙŠÙ„ Ø§Ù„ØªÙŠ Ø³ØªØ¸Ù‡Ø± Ø¹Ù†Ø¯ Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ø®Ø¯Ù…Ø©
        const serviceCommitments = {
             'branding': "Ø´Ø¹Ø§Ø±ØŒ Ø¯Ù„ÙŠÙ„ Ù‡ÙˆÙŠØ©ØŒ Ù‚Ø±Ø·Ø§Ø³ÙŠØ©ØŒ ÙˆØªØ·Ø¨ÙŠÙ‚Ø§Øª Ø§Ù„Ù‡ÙˆÙŠØ©.",
             'ui_ux': "ØªØ­Ù„ÙŠÙ„ ØªØ¬Ø±Ø¨Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ØŒ ØªØµÙ…ÙŠÙ… ÙˆØ§Ø¬Ù‡Ø§ØªØŒ Ø¨Ø±ÙˆØªÙˆØªØ§ÙŠØ¨.",
             'salla_zid': "ØªØ¬Ù‡ÙŠØ²ØŒ Ø±Ø¨Ø· Ø¯ÙˆÙ…ÙŠÙ†ØŒ Ø¥Ø¶Ø§ÙØ© Ù…Ù†ØªØ¬Ø§ØªØŒ ÙˆØ±Ø¨Ø· Ø®Ø¯Ù…Ø§Øª.",
             'wordpress': "Ø¨Ø±Ù…Ø¬Ø© Ø®Ø§ØµØ© Ø£Ùˆ Ù‚ÙˆØ§Ù„Ø¨ØŒ Ø­Ù…Ø§ÙŠØ©ØŒ ÙˆØ³Ø±Ø¹Ø©.",
             'social': "Ø®Ø·Ø© Ù…Ø­ØªÙˆÙ‰ØŒ ØªØµÙ…ÙŠÙ…Ø§ØªØŒ Ù†Ø´Ø±ØŒ ÙˆØ¬Ø¯ÙˆÙ„Ø©.",
             'mb': "Ø®Ø·Ø© Ø¥Ø¹Ù„Ø§Ù†ÙŠØ©ØŒ Ø¥Ø·Ù„Ø§Ù‚ Ø­Ù…Ù„Ø§Øª (Ø³Ù†Ø§Ø¨/ØªÙŠÙƒ ØªÙˆÙƒ/Ø§Ù†Ø³ØªØ§)ØŒ ØªÙ‚Ø§Ø±ÙŠØ±.",
             'seo': "ÙØ­Øµ ØªÙ‚Ù†ÙŠØŒ ØªØ­Ø³ÙŠÙ† Ø¯Ø§Ø®Ù„ÙŠ (On-page)ØŒ ÙˆØ¨Ù†Ø§Ø¡ Ø±ÙˆØ§Ø¨Ø·.",
             'cro': "ØªØ­Ù„ÙŠÙ„ Ø³Ù„ÙˆÙƒ Ø§Ù„Ø²Ø§Ø¦Ø±ØŒ Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª A/BØŒ ØªØ­Ø³ÙŠÙ† Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª."
        };

        // =================================================================
        // Ø§Ù„ØªØ­Ù…ÙŠÙ„ ÙˆØ§Ù„ØªÙ‡ÙŠØ¦Ø©
        // =================================================================

        function loadData() {
            try {
                const saved = localStorage.getItem(PROPOSAL_STORAGE_KEY);
                if(saved) {
                    const data = JSON.parse(saved);
                    monthlySelections = data.monthlySelections || [{}];
                    visibleMonths = Math.min(monthlySelections.length, MAX_MONTHS);
                }
                const info = JSON.parse(localStorage.getItem(CLIENT_INFO_KEY) || '{}');
                if(info.name) {
                    // ØªØ¹Ø¨Ø¦Ø© Ø§Ù„Ø­Ù‚ÙˆÙ„ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹
                    Object.keys(info).forEach(key => {
                        const el = document.getElementById(`client-${key}`);
                        if(el) el.value = info[key] || '';
                    });
                    // Mapping Ø®Ø§Øµ Ù„Ø¨Ø¹Ø¶ Ø§Ù„Ø£Ø³Ù…Ø§Ø¡ Ø§Ù„Ù…Ø®ØªÙ„ÙØ© ÙÙŠ Ø§Ù„Ù€ ID
                    if(info.phone) document.getElementById('client-contact-phone').value = info.phone;
                    if(info.socials) document.getElementById('client-social-links').value = info.socials;
                }
            } catch(e) { console.error("Error loading data", e); }
        }
        
        function renderMonthsGrid() {
            const grid = document.getElementById('months-grid');
            grid.innerHTML = '';
            for(let i=0; i<visibleMonths; i++) {
                let html = `<div class="bg-dark-secondary rounded-xl p-5 shadow-lg border border-accent-gold/30 page-break-inside-avoid transition-all hover:border-accent-gold/60">
                            <h2 class="text-xl font-bold text-accent-gold mb-4 border-b border-dark-primary pb-2 flex justify-between">
                                <span>Ø§Ù„Ø´Ù‡Ø± ${i+1}</span>
                                <span class="text-xs text-text-light/50 font-normal self-center">Ø§Ø®ØªÙŠØ§Ø±Ø§Øª: ${Object.keys(monthlySelections[i] || {}).length}</span>
                            </h2>
                            <div class="space-y-3">`;
                
                services.forEach(s => {
                    const checked = monthlySelections[i] && monthlySelections[i][s.id];
                    const desc = serviceCommitments[s.id] || '';
                    
                    // Ø¹Ø±Ø¶ Ø§Ù„Ø®Ø¯Ù…Ø© + Ø§Ù„ØªÙØ§ØµÙŠÙ„ Ø¹Ù†Ø¯ Ø§Ù„ØªØ­Ø¯ÙŠØ¯
                    html += `
                    <div class="flex flex-col group">
                        <div class="flex items-center mb-1">
                            <input type="checkbox" ${checked?'checked':''} onchange="updateSelection(${i},'${s.id}',this.checked)" class="transition-transform transform active:scale-90">
                            <span class="text-text-light font-bold mr-2 cursor-pointer select-none ${checked ? 'text-accent-gold' : 'group-hover:text-white'}" onclick="this.previousElementSibling.click()">${s.name}</span>
                        </div>
                        ${checked ? `<p class="text-xs text-text-light/70 mr-7 fade-in border-r-2 border-accent-gold pr-2 leading-relaxed">${desc}</p>` : ''}
                    </div>`;
                });
                html += `</div></div>`;
                grid.innerHTML += html;
            }
            localStorage.setItem(PROPOSAL_STORAGE_KEY, JSON.stringify({monthlySelections: monthlySelections.slice(0, visibleMonths)}));
        }

        function updateSelection(m, id, checked) {
            if(!monthlySelections[m]) monthlySelections[m] = {};
            if(checked) monthlySelections[m][id] = true; else delete monthlySelections[m][id];
            renderMonthsGrid();
        }

        function addNextMonth() { 
            if(visibleMonths < MAX_MONTHS) { 
                visibleMonths++; 
                monthlySelections.push({}); 
                renderMonthsGrid(); 
                // Scroll to bottom
                window.scrollTo({ top: document.body.scrollHeight, behavior: 'smooth' });
            } 
        }

        function getClientInfo() {
            return {
                name: document.getElementById('client-name').value,
                phone: document.getElementById('client-contact-phone').value,
                link: document.getElementById('client-link').value,
                businessType: document.getElementById('client-business-type').value,
                targetAudience: document.getElementById('client-target-audience').value,
                strategyGoal: document.getElementById('client-strategy-goal').value,
                budgetRange: document.getElementById('client-budget-range').value,
                competitors: document.getElementById('client-competitors').value,
                socials: document.getElementById('client-social-links').value,
                challenges: document.getElementById('client-challenges').value,
                additionalInfo: document.getElementById('client-additional-info').value,
                timestamp: new Date().toLocaleString()
            };
        }

        // =================================================================
        // Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø®Ø§Ø¯Ù… (Google Apps Script)
        // =================================================================

        /**
         * Ø¯Ø§Ù„Ø© Ù…ÙˆØ­Ø¯Ø© Ù„Ù„Ø¥Ø±Ø³Ø§Ù„ Ù„ØªÙØ§Ø¯ÙŠ Ù…Ø´Ø§ÙƒÙ„ Ø§Ù„Ù€ CORS ÙˆØªÙˆØ­ÙŠØ¯ Ø§Ù„Ù‡ÙŠÙƒÙ„
         * ØªØ³ØªØ®Ø¯Ù… text/plain Ù„ØªØ¬Ù†Ø¨ Preflight Request (OPTIONS)
         */
        async function sendToBackend(payload) {
            // Ù†ØºÙ„Ù Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¨Ù€ stringify ÙˆÙ†Ø±Ø³Ù„Ù‡Ø§ ÙƒÙ†Øµ Ø¹Ø§Ø¯ÙŠ
            const response = await fetch(GOOGLE_SCRIPT_URL, {
                method: "POST",
                mode: "cors", // Ø§Ø³ØªØ®Ø¯Ø§Ù… no-cors Ø³ÙŠØ®ÙÙŠ Ø§Ù„Ø±Ø¯ØŒ Ù„Ø°Ø§ Ù†Ø³ØªØ®Ø¯Ù… cors Ù…Ø¹ text/plain
                headers: { "Content-Type": "text/plain;charset=utf-8" }, 
                body: JSON.stringify(payload)
            });
            
            if (!response.ok) throw new Error(`Server Error: ${response.status}`);
            
            // Ù…Ø­Ø§ÙˆÙ„Ø© Ù‚Ø±Ø§Ø¡Ø© Ø§Ù„Ø±Ø¯ ÙƒÙ€ JSON
            const text = await response.text();
            console.log("Raw Response from Server:", text); // Debugging Log

            try {
                return JSON.parse(text);
            } catch (e) {
                // Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„Ø±Ø¯ Ù†ØµØ§Ù‹ Ø¹Ø§Ø¯ÙŠØ§Ù‹ Ø£Ùˆ HTML (Ø®Ø·Ø£)
                return text; 
            }
        }

        async function handleClientInfoSubmit() {
            const info = getClientInfo();
            if(!info.name) {
                showMessage("Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ø³Ù… Ø§Ù„Ù…Ø´Ø±ÙˆØ¹ Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„", "bg-red-600");
                return;
            }
            
            localStorage.setItem(CLIENT_INFO_KEY, JSON.stringify(info));
            const btn = document.getElementById('save-client-info-btn');
            const originalText = btn.textContent;
            btn.disabled = true; btn.textContent = 'Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø®Ø§Ø¯Ù…...';

            try {
                // Ø¥Ø±Ø³Ø§Ù„ Ù†ÙˆØ¹ Ø§Ù„Ø·Ù„Ø¨ (action: save_client)
                const res = await sendToBackend({ action: 'save_client', data: info });
                
                showMessage("ØªÙ… Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¨Ù†Ø¬Ø§Ø­!", "bg-highlight-green");
                closeClientInfoModal();
                
                // Ø¥Ø°Ø§ ÙƒÙ†Ø§ ÙÙŠ ÙˆØ¶Ø¹ Ø§Ù„Ù…Ø³Ø§Ø¹Ø¯ØŒ Ù†ÙØªØ­ Ø§Ù„Ø´Ø§Øª ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹
                if(isAssistantMode) setTimeout(() => openAiModal(true), 500);

            } catch(e) {
                console.error(e);
                showMessage("ØªÙ… Ø§Ù„Ø­ÙØ¸ Ù…Ø­Ù„ÙŠØ§Ù‹ (ÙØ´Ù„ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø³ÙŠØ±ÙØ±).", "bg-highlight-orange");
                closeClientInfoModal();
                if(isAssistantMode) setTimeout(() => openAiModal(true), 500);
            } finally {
                btn.disabled = false; btn.textContent = originalText;
            }
        }

        async function callAssistant(payload) {
            try {
                // Ø¨Ù†Ø§Ø¡ Ø§Ù„Ø³ÙŠØ§Ù‚ (Prompt) Ù‡Ù†Ø§
                const systemPrompt = `
                    Ø£Ù†Øª "Ù…Ø³Ø§Ø¹Ø¯ Ø¶Ø§Ø¯"ØŒ Ø§Ù„Ù…Ø³ØªØ´Ø§Ø± Ø§Ù„Ø°ÙƒÙŠ Ù„Ø´Ø±ÙƒØ© "Ø¶Ø§Ø¯" (Daad) Ø§Ù„Ù…ØªØ®ØµØµØ© ÙÙŠ Ø§Ù„ØªØ³ÙˆÙŠÙ‚ Ø§Ù„Ø±Ù‚Ù…ÙŠ ÙˆØ§Ù„Ø¨Ø±Ù…Ø¬Ø©.
                    Ù‡Ø¯Ù Ø§Ù„Ø´Ø±ÙƒØ©: Ù…Ø³Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡ Ø¹Ù„Ù‰ Ø§Ù„Ù†Ù…Ùˆ Ù…Ù† Ø®Ù„Ø§Ù„ Ø­Ù„ÙˆÙ„ ØªÙ‚Ù†ÙŠØ© ÙˆØªØ³ÙˆÙŠÙ‚ÙŠØ©.
                    
                    Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¹Ù…ÙŠÙ„ Ø§Ù„Ø­Ø§Ù„ÙŠØ©: ${JSON.stringify(payload.clientInfo)}
                    
                    ØªØ¹Ù„ÙŠÙ…Ø§ØªÙƒ:
                    1. ÙƒÙ† ÙˆØ¯ÙˆØ¯Ø§Ù‹ØŒ Ù…Ø­ØªØ±ÙØ§Ù‹ØŒ ÙˆØªØ­Ø¯Ø« Ø¨Ø§Ù„Ù„Ù‡Ø¬Ø© Ø§Ù„Ø³Ø¹ÙˆØ¯ÙŠØ© Ø§Ù„Ø¨ÙŠØ¶Ø§Ø¡ Ø§Ù„Ø±Ø§Ù‚ÙŠØ©.
                    2. Ù‚Ø¯Ù… Ù†ØµØ§Ø¦Ø­ Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ "Ø§Ù„Ø®Ø¯Ù…Ø§Øª Ø§Ù„Ù…ØªØ§Ø­Ø©" (SEO, Ads, Branding, Websites).
                    3. Ù„Ø§ ØªØ®ØªØ±Ø¹ Ø®Ø¯Ù…Ø§Øª ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯Ø© ÙÙŠ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©.
                    4. Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„Ø¹Ù…ÙŠÙ„ Ø¬Ø¯ÙŠØ¯Ø§Ù‹ØŒ Ø±Ø­Ø¨ Ø¨Ù‡ Ø¨Ø§Ø³Ù…Ù‡ ÙˆØ§Ù‚ØªØ±Ø­ Ø®Ø·Ø© Ù…Ø¨Ø¯Ø¦ÙŠØ© Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ù‡Ø¯ÙÙ‡.
                    5. Ø§Ø¬Ø¹Ù„ Ø±Ø¯ÙˆØ¯Ùƒ Ù…Ø®ØªØµØ±Ø© ÙˆÙ…Ù‚Ø³Ù…Ø© Ù„Ù†Ù‚Ø§Ø· Ù„ØªØ³Ù‡ÙŠÙ„ Ø§Ù„Ù‚Ø±Ø§Ø¡Ø©.
                `;

                let contents = [{ role: "user", parts: [{ text: systemPrompt }] }];
                
                // Ø¥Ø¶Ø§ÙØ© Ø³Ø¬Ù„ Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø©
                if (payload.history && payload.history.length > 0) {
                    contents = contents.concat(payload.history);
                }

                // Ø¥Ø±Ø³Ø§Ù„ Ù†ÙˆØ¹ Ø§Ù„Ø·Ù„Ø¨ (action: chat)
                const data = await sendToBackend({ 
                    action: 'chat', 
                    contents: contents 
                });

                // --- ØªØ­Ø³ÙŠÙ† Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ø±Ø¯ (Robust Error Handling) ---
                let replyText = null;

                // 1. Ù‡ÙŠÙƒÙ„ Gemini Ø§Ù„Ù‚ÙŠØ§Ø³ÙŠ
                if (data?.candidates?.[0]?.content?.parts?.[0]?.text) {
                    replyText = data.candidates[0].content.parts[0].text;
                }
                
                // 2. Ø±Ø¯ Ù…Ø¨Ø§Ø´Ø± (Ù†Øµ)
                else if (typeof data === 'string') {
                    replyText = data;
                }

                // 3. Ù‡ÙŠÙƒÙ„ Ù…Ø¨Ø³Ø· (Ù…Ø«Ù„Ø§Ù‹: {text: "..."} Ø£Ùˆ {result: "..."})
                else if (data?.text) {
                    replyText = data.text;
                }
                else if (data?.result && typeof data.result === 'string') {
                    replyText = data.result;
                }

                // 4. ÙØ­Øµ ÙˆØ¬ÙˆØ¯ Ø®Ø·Ø£ ØµØ±ÙŠØ­ Ù…Ù† Ø§Ù„Ø³ÙƒØ±Ø¨Øª
                else if (data?.error) {
                    replyText = `âš ï¸ Ø®Ø·Ø£ Ù…Ù† Ø§Ù„Ø³ÙŠØ±ÙØ±: ${JSON.stringify(data.error)}`;
                }
                else if (data?.message) {
                    replyText = `âš ï¸ Ø±Ø³Ø§Ù„Ø© Ù…Ù† Ø§Ù„Ø³ÙŠØ±ÙØ±: ${data.message}`;
                }

                // 5. ÙÙŠ Ø­Ø§Ù„ ÙˆØµÙˆÙ„ ÙƒØ§Ø¦Ù† JSON ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ (Ù„Ù„Ù€ Debugging)
                if (!replyText && typeof data === 'object') {
                    console.warn("Unknown response structure:", data);
                    // Ù†Ù‚ÙˆÙ… Ø¨Ø¹Ø±Ø¶ Ø§Ù„Ø±Ø¯ ÙƒÙ…Ø§ Ù‡Ùˆ Ù„Ù†ÙÙ‡Ù… Ø§Ù„Ù…Ø´ÙƒÙ„Ø©
                    replyText = "âš ï¸ Ø§Ø³ØªØ¬Ø§Ø¨Ø© ØºÙŠØ± Ù…ØªÙˆÙ‚Ø¹Ø©: " + JSON.stringify(data);
                }

                return replyText || "Ø¹Ø°Ø±Ø§Ù‹ØŒ ÙˆØµÙ„ Ø±Ø¯ ÙØ§Ø±Øº Ù…Ù† Ø§Ù„Ø®Ø§Ø¯Ù….";

            } catch (e) {
                return `âš ï¸ Ø®Ø·Ø£ Ø§ØªØµØ§Ù„: ${e.message}`;
            }
        }

        // =================================================================
        // Ù…Ù†Ø·Ù‚ ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… (UI Logic)
        // =================================================================

        async function triggerAssistantAnalysis() {
            const info = JSON.parse(localStorage.getItem(CLIENT_INFO_KEY) || '{}');
            addChatMsg("Ø¬Ø§Ø±ÙŠ ØªØ­Ù„ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§ØªÙƒ ÙˆØ§Ù‚ØªØ±Ø§Ø­ Ø®Ø·Ø©...", 'bot', true);
            
            const reply = await callAssistant({ history: [], clientInfo: info, isFirstRun: true });
            removeLoading();
            addChatMsg(reply, 'bot');
            
            if(!reply.startsWith('âš ï¸')) {
                chatHistory.push({role: 'model', parts: [{text: reply}]});
            }
        }

        async function sendChatMessage() {
            const inputEl = document.getElementById('chat-input');
            const txt = inputEl.value.trim();
            if(!txt) return;
            
            addChatMsg(txt, 'user');
            inputEl.value = '';
            
            // Ø¥Ø¶Ø§ÙØ© Ø±Ø³Ø§Ù„Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ù„Ù„ØªØ§Ø±ÙŠØ®
            chatHistory.push({role: 'user', parts: [{text: txt}]});
            
            const info = JSON.parse(localStorage.getItem(CLIENT_INFO_KEY) || '{}');
            addChatMsg("...", 'bot', true);

            const reply = await callAssistant({ history: chatHistory, clientInfo: info });
            removeLoading();
            addChatMsg(reply, 'bot');
            
            if(!reply.startsWith('âš ï¸')) {
                chatHistory.push({role: 'model', parts: [{text: reply}]});
            }
        }

        function addChatMsg(txt, sender, isLoading) {
            const div = document.createElement('div');
            div.className = `chat-message p-4 rounded-xl shadow-sm mb-3 fade-in ${sender==='user'?'user-message rounded-bl-none':'bot-message rounded-br-none'}`;
            
            if(isLoading) {
                div.id = "loading-msg";
                div.innerHTML = `<div class="loading-dots gap-1 flex"><span></span><span></span><span></span></div>`;
            } else {
                // ØªØ­Ø³ÙŠÙ† ØªÙ†Ø³ÙŠÙ‚ Ø§Ù„Ù†Øµ (Markdown Ø¨Ø³ÙŠØ·)
                let formatted = txt
                    .replace(/</g, "&lt;").replace(/>/g, "&gt;") // Ø­Ù…Ø§ÙŠØ© Ù…Ù† HTML Injection
                    .replace(/\*\*(.*?)\*\*/g, '<strong class="text-accent-gold">$1</strong>') // Bold
                    .replace(/\*(.*?)\*/g, '<em>$1</em>') // Italic
                    .replace(/^- (.*)/gm, '<ul class="list-disc pr-5"><li>$1</li></ul>') // Lists
                    .replace(/\n/g, '<br>');
                div.innerHTML = formatted;
            }
            
            const log = document.getElementById('chat-log');
            log.appendChild(div);
            log.scrollTop = log.scrollHeight; // Scroll to bottom
        }

        function removeLoading() { const l = document.getElementById('loading-msg'); if(l) l.remove(); }
        
        function showMessage(msg, bgClass) {
            const el = document.getElementById('system-message'); 
            el.textContent = msg; 
            el.className = `fixed top-24 right-4 p-4 rounded-xl shadow-xl z-50 text-white font-bold ${bgClass}`;
            el.classList.remove('translate-y-10', 'opacity-0'); 
            setTimeout(() => el.classList.add('translate-y-10', 'opacity-0'), 3000);
        }

        function openAiModal(auto) {
            document.getElementById('ai-modal').classList.remove('hidden', 'opacity-0', 'pointer-events-none');
            if(auto && chatHistory.length === 0) {
                triggerAssistantAnalysis();
            } else if (!auto && document.getElementById('chat-log').children.length === 0) {
                addChatMsg("Ø­ÙŠØ§Ùƒ Ø§Ù„Ù„Ù‡ØŒ Ø£Ù†Ø§ Ù…Ø³Ø§Ø¹Ø¯ Ø¶. ÙƒÙŠÙ Ø£Ù‚Ø¯Ø± Ø£Ø³Ø§Ø¹Ø¯Ùƒ ÙÙŠ ØªØ®Ø·ÙŠØ· Ù…Ø´Ø±ÙˆØ¹Ùƒ Ø§Ù„ÙŠÙˆÙ…ØŸ", 'bot');
            }
        }
        
        function closeAiModal() { 
            document.getElementById('ai-modal').classList.add('opacity-0', 'pointer-events-none'); 
            setTimeout(()=>document.getElementById('ai-modal').classList.add('hidden'),300); 
        }
        
        function openClientInfoModal() { document.getElementById('client-info-modal').classList.remove('hidden', 'opacity-0', 'pointer-events-none'); }
        
        function closeClientInfoModal() { 
            document.getElementById('client-info-modal').classList.add('opacity-0', 'pointer-events-none'); 
            setTimeout(()=>document.getElementById('client-info-modal').classList.add('hidden'),300); 
        }
        
        function selectManualMode() { 
            document.getElementById('home-view').classList.add('hidden'); 
            document.getElementById('app-view').classList.remove('hidden'); 
            window.scrollTo(0,0);
        }
        
        function selectAssistantMode() { 
            isAssistantMode = true; 
            selectManualMode(); 
            openClientInfoModal(); 
        }
        
        function generateTechnicalProposal() { window.print(); }

        window.onload = function() { loadData(); renderMonthsGrid(); };
    </script>
</body>
</html>
